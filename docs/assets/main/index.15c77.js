window.__require=function t(e,o,r){function i(s,c){if(!o[s]){if(!e[s]){var l=s.split("/");if(l=l[l.length-1],!e[l]){var a="function"==typeof __require&&__require;if(!c&&a)return a(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return i(e[s][1][t]||t)},u,u.exports,t,e,o,r)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<r.length;s++)i(r[s]);return i}({BoardController:[function(t,e,o){"use strict";cc._RF.push(e,"c9481Dj97JHHoGZXsXufu8F","BoardController");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(i,n){function s(t){try{l(r.next(t))}catch(e){n(e)}}function c(t){try{l(r.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,r,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],r=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardControllerEvent=void 0;var l,a=t("./BoardModel"),u=t("../Tile/TileController"),p=t("../TileType"),f=t("../Services/TileModelFactory"),h=t("../Services/TileBehaviourService"),d=t("../utils/Utils"),y=t("../utils/EffectProcessor"),v=t("./TileLifecycleManager"),g=cc._decorator,m=g.ccclass,b=g.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.board=null,e.tileContainer=null,e.tileLifecycleManager=null,e.numColumns=8,e.numRows=7,e.usedTileTypes=4,e.tileTypes=[],e.specialTileTypes=[],e.shuffleAttempts=3,e.modelToController=new Map,e.spawnField=[],e.baseDelay=50,e}return i(e,t),e.prototype.init=function(){var t=this;this.reset(),this.tileModelFactory=new f.default,this.behaviourService=new h.default,this.effectProcessor=new y.default(function(e){return t.handleEffect(e)},function(){t.spawnField.fill(0),t.checkMoves()});var e=this.tileContainer.getContentSize().width/this.numColumns,o=this.tileTypes.slice(0,this.usedTileTypes).map(function(t){return t.type});this.BoardModel=new a.default(this.numColumns,this.numRows,o,this.tileModelFactory);var r=this.tileContainer.getComponent(cc.Widget);this.board.setContentSize(this.board.getContentSize().width,this.numRows*e+r.top+r.bottom),this.tileLifecycleManager.setup(e,this.tileTypes,this.specialTileTypes,this.numColumns,this.numRows),this.createTiles(),this.spawnField=new Array(this.numColumns).fill(0)},e.prototype.createTiles=function(){for(var t=0,e=this.BoardModel.tiles;t<e.length;t++){var o=e[t];this.modelToController.has(o)||this.createTile(o)}},e.prototype.createTile=function(t,e){var o=this.tileLifecycleManager.createTile(t,e);return this.modelToController.set(t,o),o.node.on(cc.Node.EventType.TOUCH_END,this.onTileClick,this),o},e.prototype.onTileClick=function(t){var e=t.currentTarget.getComponent(u.default).tileId,o=this.BoardModel.getTileById(e);this.effectProcessor.addEffect(0,{cause:o})},e.prototype.handleEffect=function(t){var e;return s(this,void 0,void 0,function(){var o,r;return c(this,function(i){switch(i.label){case 0:return(o=this.behaviourService.run(t.data.cause,this.BoardModel)).length>1?(this.node.emit(l.MOVE_PERFORMED),r=void 0,t.data.cause.behaviour?this.checkChainReaction(o,t.data.cause):r=this.createSpecialTile(o,t.data.cause.position),this.BoardModel.stageRemoving(o,t.commitId),r&&(this.BoardModel.setTileAt(r.position,r),this.createTile(r,r.position)),[4,this.animateRemoveTiles(t,o)]):[3,3];case 1:return i.sent(),this.node.emit(l.TILES_REMOVED,o),[4,d.delay(50)];case 2:return i.sent(),this.BoardModel.commit(t.commitId),this.syncTiles(t.commitId),[3,4];case 3:null===(e=this.modelToController.get(t.data.cause))||void 0===e||e.rejectAction(),i.label=4;case 4:return[2]}})})},e.prototype.checkChainReaction=function(t,e){var o=this;t.forEach(function(t){if(e!==t&&t.behaviour&&0===t.commitId){var r=d.getDistance(e.position,t.position);o.effectProcessor.addEffect(r*o.baseDelay,{cause:t})}})},e.prototype.createSpecialTile=function(t,e){var o=this.behaviourService.getBehaviour(t);return o?this.tileModelFactory.create({type:"special",behaviour:o,position:e}):null},e.prototype.animateRemoveTiles=function(t,e){return s(this,void 0,void 0,function(){var o,r,i,n,l,a,u=this;return c(this,function(p){switch(p.label){case 0:for(o=[],r=function(e){var r=i.modelToController.get(e);if(r){var n=t.data.cause.behaviour?d.getDistance(t.data.cause.position,e.position):0,l=d.delay(n*i.baseDelay).then(function(){return s(u,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.tileLifecycleManager.removeTile(r)];case 1:return t.sent(),r.node.off(cc.Node.EventType.TOUCH_END,this.onTileClick,this),[2]}})})});o.push(l)}i.modelToController.delete(e)},i=this,n=0,l=e;n<l.length;n++)a=l[n],r(a);return[4,Promise.all(o)];case 1:return p.sent(),[2]}})})},e.prototype.syncTiles=function(t){for(var e=this.BoardModel.tiles.length-1;e>=0;e--){var o=this.BoardModel.tiles[e],r=this.modelToController.get(o);if(!r&&o.commitId===t){var i=this.getSpawnPosition(o);r=this.createTile(o,i),o.commitId=0}null==r||r.setPosition(o.position)}},e.prototype.getSpawnPosition=function(t){return this.spawnField[t.position.x]++,{x:t.position.x,y:-this.spawnField[t.position.x]-2}},e.prototype.checkMoves=function(t){return void 0===t&&(t=1),s(this,void 0,void 0,function(){var e,o,r,i,n;return c(this,function(s){switch(s.label){case 0:if(t>this.shuffleAttempts)return this.node.emit(l.NO_MOVES_LEFT),[2];for(e={},o=!1,r=0,i=this.BoardModel.tiles;r<i.length;r++)if(n=i[r],e[n.group]=(e[n.group]||0)+1,e[n.group]>1||n.behaviour){o=!0;break}return o?[3,2]:[4,d.delay(700)];case 1:s.sent(),this.BoardModel.shuffleTiles(),this.syncTiles(-1),this.checkMoves(t+1),s.label=2;case 2:return[2]}})})},e.prototype.reset=function(){var t,e,o=this;this.modelToController.forEach(function(t){t.node.off(cc.Node.EventType.TOUCH_END,o.onTileClick,o),t.node.destroy()}),this.modelToController.clear(),this.tileLifecycleManager.reset(),null===(t=this.tileModelFactory)||void 0===t||t.clearPool(),this.spawnField=new Array(this.numColumns).fill(0),null===(e=this.BoardModel)||void 0===e||e.clear()},n([b(cc.Node)],e.prototype,"board",void 0),n([b(cc.Node)],e.prototype,"tileContainer",void 0),n([b(v.default)],e.prototype,"tileLifecycleManager",void 0),n([b(cc.Integer)],e.prototype,"numColumns",void 0),n([b(cc.Integer)],e.prototype,"numRows",void 0),n([b],e.prototype,"usedTileTypes",void 0),n([b([p.default])],e.prototype,"tileTypes",void 0),n([b([p.default])],e.prototype,"specialTileTypes",void 0),n([b],e.prototype,"shuffleAttempts",void 0),n([m],e)}(cc.Component);o.default=_,function(t){t.MOVE_PERFORMED="move-performed",t.TILES_REMOVED="tiles-removed",t.NO_MOVES_LEFT="no-moves-left"}(l=o.BoardControllerEvent||(o.BoardControllerEvent={})),cc._RF.pop()},{"../Services/TileBehaviourService":"TileBehaviourService","../Services/TileModelFactory":"TileModelFactory","../Tile/TileController":"TileController","../TileType":"TileType","../utils/EffectProcessor":"EffectProcessor","../utils/Utils":"Utils","./BoardModel":"BoardModel","./TileLifecycleManager":"TileLifecycleManager"}],BoardModel:[function(t,e,o){"use strict";cc._RF.push(e,"56440RTNChCEp+lGKXquWW2","BoardModel");var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<o;e++)for(var n=arguments[e],s=0,c=n.length;s<c;s++,i++)r[i]=n[s];return r};Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(t,e,o,r){this.grid=[],this.tileTypes=[],this.numColumns=t,this.numRows=e,this.tileTypes=o,this.tileFactory=r,this.generateGrid()}return Object.defineProperty(t.prototype,"tiles",{get:function(){return this.grid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.numColumns},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.numRows},enumerable:!1,configurable:!0}),t.prototype.getTileById=function(t){return this.grid.find(function(e){return e&&e.id===t})||null},t.prototype.getTileAt=function(t,e){var o=this.getTileIndexAt(t,e);return-1!==o?this.grid[o]:null},t.prototype.setTileAt=function(t,e){var o=this.getTileIndexAt(t.y,t.x);-1!==o&&(this.grid[o]=e)},t.prototype.stageRemoving=function(t,e){for(var o=0,r=t;o<r.length;o++){var i=r[o],n=this.getTileIndexAt(i.position.y,i.position.x);this.grid[n]&&0===i.commitId&&(this.grid[n].commitId=e)}},t.prototype.commit=function(t){this.performRemove(t),this.shiftTilesDown(),this.fillEmptyTiles(t),this.assignGroups()},t.prototype.shuffleTiles=function(){var t=this;this.grid=this.grid.sort(function(){return Math.random()-.5}),this.grid.forEach(function(e,o){e.position={x:o%t.numColumns,y:Math.floor(o/t.numColumns)}}),this.assignGroups()},t.prototype.clear=function(){this.grid=[]},t.prototype.performRemove=function(t){for(var e=this.grid.length-1;e>=0;e--){var o=this.grid[e];o&&o.commitId===t&&(this.grid[e]=null)}},t.prototype.generateGrid=function(){this.grid=[];for(var t=0;t<this.numRows;t++)for(var e=0;e<this.numColumns;e++){var o=this.tileFactory.create({position:{x:e,y:t},type:this.getRandomTileType()});this.grid.push(o)}this.assignGroups()},t.prototype.shiftTilesDown=function(){for(var t=this.grid.length-1;t>=0;t--)if(!this.grid[t]){var e={x:t%this.numColumns,y:Math.floor(t/this.numColumns)},o=this.getFirstAboveTileIndex(e);-1!==o&&(this.grid[t]=this.grid[o],this.grid[o]=null,this.grid[t].position=e)}},t.prototype.fillEmptyTiles=function(t){for(var e=0;e<this.grid.length;e++)this.grid[e]||(this.grid[e]=this.tileFactory.create({position:{x:e%this.numColumns,y:Math.floor(e/this.numColumns)},type:this.getRandomTileType()}),this.grid[e].commitId=t)},t.prototype.assignGroups=function(){for(var t=0,e=this.grid;t<e.length;t++)(n=e[t])&&(n.group=null);for(var o=0,r=0,i=this.grid;r<i.length;r++){var n;(n=i[r])&&!n.group&&(this.fillGroup(o.toString(),n),o++)}},t.prototype.fillGroup=function(t,e){for(var o=e.type,r=[e];r.length>0;){var i=r.pop();if(this.addTileToGroup(i,t,o))for(var n=0,s=this.getNeighbors(i);n<s.length;n++){var c=s[n];c.group||c.type!==i.type||r.push(c)}}},t.prototype.addTileToGroup=function(t,e,o){return!t.group&&o===t.type&&(t.group=e,!0)},t.prototype.getNeighbors=function(t){for(var e=[],o=0,r=[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}];o<r.length;o++){var i=r[o],n=this.getTileAt(t.position.y+i.y,t.position.x+i.x);n&&e.push(n)}return e},t.prototype.getFirstAboveTileIndex=function(t){for(var e,o=t.y-1;o>=0;o--){var r=this.getTileIndexAt(o,t.x);if(-1!==r&&0===(null===(e=this.grid[r])||void 0===e?void 0:e.commitId))return r}return-1},t.prototype.getTileIndexAt=function(t,e){return t<0||t>=this.numRows||e<0||e>=this.numColumns?-1:t*this.numColumns+e},t.prototype.getRandomTileType=function(){return this.tileTypes[Math.floor(Math.random()*this.tileTypes.length)]},t.prototype.gridConsoleView=function(t,e){for(var o="%c["+t+"]:\n",i=["color: "+n[e%6]],s=0;s<this.numRows;s++){for(var c="",l=0;l<this.numColumns;l++){var a=this.getTileAt(s,l),u=void 0,p="";a&&a.behaviour?(u=" S ",p="color: "+n[a.commitId%6]+"; font-weight: bold;"):a?(u=(" "+a.commitId).slice(-2).padStart(3," "),p="color: "+n[a.commitId%6]+";"):(u="   ",p="color: #fff;"),c+="%c["+u+"] ",i.push(p)}o+=c.trim()+"\n"}console.log.apply(console,r([o],i))},t}();o.default=i;var n={0:"white",1:"green",2:"blue",3:"yellow",4:"purple",5:"orange"};cc._RF.pop()},{}],DialogController:[function(t,e,o){"use strict";cc._RF.push(e,"d64629SIUtCMYa8xirvwWLo","DialogController");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./DialogView"),c=cc._decorator,l=c.ccclass,a=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.backdrop=null,e.successDialog=null,e.failureDialog=null,e.dialogs={},e}return i(e,t),e.prototype.start=function(){var t;this.dialogs=((t={})[this.successDialog.dialogId]=this.successDialog,t[this.failureDialog.dialogId]=this.failureDialog,t),this.successDialog.node.on("confirm",this.onRetry,this),this.failureDialog.node.on("confirm",this.onRetry,this),this.hideDialogs()},e.prototype.destroy=function(){return this.successDialog.node.off("confirm",this.onRetry,this),this.failureDialog.node.off("confirm",this.onRetry,this),t.prototype.destroy.call(this)},e.prototype.showSuccessDialog=function(){this.showDialog(this.successDialog.dialogId)},e.prototype.showFailureDialog=function(){this.showDialog(this.failureDialog.dialogId)},e.prototype.showDialog=function(t){this.hideDialogs(),this.backdrop.active=!0;var e=this.dialogs[t];e&&(e.node.active=!0)},e.prototype.hideDialogs=function(){this.backdrop.active=!1,Object.values(this.dialogs).forEach(function(t){return t.node.active=!1})},e.prototype.onRetry=function(){this.backdrop.active=!1,this.successDialog.node.active=!1,this.failureDialog.node.active=!1,this.node.emit("retry")},n([a(cc.Node)],e.prototype,"backdrop",void 0),n([a(s.default)],e.prototype,"successDialog",void 0),n([a(s.default)],e.prototype,"failureDialog",void 0),n([l],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./DialogView":"DialogView"}],DialogView:[function(t,e,o){"use strict";cc._RF.push(e,"c07f1U2yctDDqKwTTRWT3Kg","DialogView");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,l=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dialogId="",e.confirmButton=null,e}return i(e,t),e.prototype.start=function(){this.confirmButton.node.on("click",this.onConfirmButtonClicked,this)},e.prototype.destroy=function(){return this.confirmButton.node.off("click",this.onConfirmButtonClicked,this),t.prototype.destroy.call(this)},e.prototype.onConfirmButtonClicked=function(){this.node.emit("confirm")},n([l],e.prototype,"dialogId",void 0),n([l(cc.Button)],e.prototype,"confirmButton",void 0),n([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],EffectControllerBase:[function(t,e,o){"use strict";cc._RF.push(e,"f522fqQiNpFCJlB+h9yyVZB","EffectControllerBase");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,l=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),n([c],e)}(cc.Component));o.default=l,cc._RF.pop()},{}],EffectProcessor:[function(t,e,o){"use strict";cc._RF.push(e,"bf148hHvRVMNKsVJHqFnjvx","EffectProcessor");var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(i,n){function s(t){try{l(r.next(t))}catch(e){n(e)}}function c(t){try{l(r.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],r=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Utils"),s=function(){function t(t,e){this.effectHandler=t,this.completeHandler=e,this.lastCommitId=1,this.effectsRunning=0}return t.prototype.addEffect=function(t,e){var o={delay:t,commitId:this.lastCommitId++,data:e};return this.processEffect(o),o},t.prototype.processEffect=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this.effectsRunning++,[4,n.delay(t.delay)];case 1:return e.sent(),[4,this.effectHandler(t)];case 2:return e.sent(),this.effectsRunning--,0===this.effectsRunning&&(this.lastCommitId=1,this.completeHandler()),[2]}})})},t}();o.default=s,cc._RF.pop()},{"./Utils":"Utils"}],GameController:[function(t,e,o){"use strict";cc._RF.push(e,"c3393w3PulLB6fFwQdP3I4g","GameController");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./Board/BoardController"),c=t("./Dialogs/DialogController"),l=t("./GameProgress/ProgressControllerBase"),a=t("./utils/Utils"),u=cc._decorator,p=u.ccclass,f=u.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardController=null,e.gameProgress=null,e.dialogController=null,e.gameOverDelay=1e3,e}return i(e,t),e.prototype.start=function(){this.boardController.node.on(s.BoardControllerEvent.MOVE_PERFORMED,this.onMovePerformed,this),this.boardController.node.on(s.BoardControllerEvent.TILES_REMOVED,this.onTilesRemoved,this),this.boardController.node.on(s.BoardControllerEvent.NO_MOVES_LEFT,this.onNoMovesLeft,this),this.gameProgress.node.on(l.ProgressControllerEvent.GOAL_REACHED,this.onGoalReached,this),this.gameProgress.node.on(l.ProgressControllerEvent.FAILED,this.onNoMovesLeft,this),this.dialogController.node.on("retry",this.retry,this),this.boardController.init()},e.prototype.destroy=function(){return this.boardController.node.off(s.BoardControllerEvent.TILES_REMOVED,this.onTilesRemoved,this),this.gameProgress.node.off(l.ProgressControllerEvent.GOAL_REACHED,this.onGoalReached,this),this.gameProgress.node.off(l.ProgressControllerEvent.FAILED,this.onNoMovesLeft,this),this.dialogController.node.off("retry",this.retry,this),t.prototype.destroy.call(this)},e.prototype.onMovePerformed=function(){this.gameProgress.onMovePerformed()},e.prototype.onTilesRemoved=function(t){this.gameProgress.onTilesRemoved(t)},e.prototype.onGoalReached=function(){var t=this;a.delay(this.gameOverDelay).then(function(){t.dialogController.showSuccessDialog()})},e.prototype.onNoMovesLeft=function(){var t=this;a.delay(this.gameOverDelay).then(function(){t.dialogController.showFailureDialog()})},e.prototype.retry=function(){this.gameProgress.reset(),this.boardController.init()},n([f(s.default)],e.prototype,"boardController",void 0),n([f(l.default)],e.prototype,"gameProgress",void 0),n([f(c.default)],e.prototype,"dialogController",void 0),n([p],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./Board/BoardController":"BoardController","./Dialogs/DialogController":"DialogController","./GameProgress/ProgressControllerBase":"ProgressControllerBase","./utils/Utils":"Utils"}],ObjectPool:[function(t,e,o){"use strict";cc._RF.push(e,"7f8cb575i5BT7nWM2MBr2ZL","ObjectPool"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(t){this.prefab=null,this.pool=[],this.prefab=t}return t.prototype.create=function(t){var e;return(e=this.pool.length>0?this.pool.pop():cc.instantiate(this.prefab)).active=!0,t&&t.addChild(e),e},t.prototype.release=function(t){t.removeFromParent(),t.active=!1,this.pool.push(t)},t.prototype.clear=function(){this.pool.forEach(function(t){t.destroy()}),this.pool.length=0},t}();o.default=r,cc._RF.pop()},{}],ParticleController:[function(t,e,o){"use strict";cc._RF.push(e,"e9f9dWbTrZEPL+McnzIhIwV","ParticleController");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./EffectControllerBase"),c=t("../utils/Utils"),l=cc._decorator,a=l.ccclass,u=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.particleSystems=[],e.duration=0,e}return i(e,t),e.prototype.onLoad=function(){this.particleSystems=this.node.getComponentsInChildren(cc.ParticleSystem),this.duration=this.particleSystems.reduce(function(t,e){return Math.max(t,e.duration)},0)},e.prototype.playEffect=function(){var t=this;this.particleSystems.forEach(function(t){t.resetSystem()}),c.delay(1e3*this.duration).then(function(){t.node.emit("finished")})},n([a],e)}(s.default));o.default=u,cc._RF.pop()},{"../utils/Utils":"Utils","./EffectControllerBase":"EffectControllerBase"}],Point:[function(t,e,o){"use strict";cc._RF.push(e,"46f2dELNZhIa50QW1BSeGko","Point"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ProgressControllerBase:[function(t,e,o){"use strict";cc._RF.push(e,"be9ffzPQcVPhbV4fZZLoeoc","ProgressControllerBase");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.ProgressControllerEvent=void 0;var s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),n([s],e)}(cc.Component);o.default=c,function(t){t.GOAL_REACHED="goal_reached",t.FAILED="failed"}(o.ProgressControllerEvent||(o.ProgressControllerEvent={})),cc._RF.pop()},{}],ScoreProgressController:[function(t,e,o){"use strict";cc._RF.push(e,"dac5czBlZZKGo/9hTUevnvy","ScoreProgressController");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./ProgressControllerBase"),c=cc._decorator,l=c.ccclass,a=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.movesLabel=null,e.scoreLabel=null,e.movesLimit=10,e.scoreTarget=100,e.movesLeft=0,e.currentScore=0,e}return i(e,t),e.prototype.start=function(){this.movesLeft=this.movesLimit,this.updateView()},e.prototype.reset=function(){this.movesLeft=this.movesLimit,this.currentScore=0,this.updateView()},e.prototype.onMovePerformed=function(){this.movesLeft--,this.updateMovesLabel()},e.prototype.onTilesRemoved=function(t){var e=this.currentScore,o=t.filter(function(t){return!t.behaviour}).length;this.currentScore=Math.min(this.currentScore+o,this.scoreTarget),this.updateScoreLabel(e),this.checkState()},e.prototype.checkState=function(){this.currentScore>=this.scoreTarget?this.node.emit(s.ProgressControllerEvent.GOAL_REACHED):this.movesLeft<=0&&this.node.emit(s.ProgressControllerEvent.FAILED)},e.prototype.updateView=function(){this.updateMovesLabel(),this.updateScoreLabel()},e.prototype.updateMovesLabel=function(){this.movesLabel.string=this.movesLeft.toString()},e.prototype.updateScoreLabel=function(t){var e=this;void 0===t&&(t=0),cc.tween({value:t}).to(.2,{value:this.currentScore},{onUpdate:function(t){e.scoreLabel.string=Math.floor(t.value)+"/"+e.scoreTarget}}).start()},n([a(cc.Label)],e.prototype,"movesLabel",void 0),n([a(cc.Label)],e.prototype,"scoreLabel",void 0),n([a],e.prototype,"movesLimit",void 0),n([a],e.prototype,"scoreTarget",void 0),n([l],e)}(s.default);o.default=u,cc._RF.pop()},{"./ProgressControllerBase":"ProgressControllerBase"}],TileBehaviourService:[function(t,e,o){"use strict";cc._RF.push(e,"30068uIehZHQa932jbPAk2I","TileBehaviourService"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileBehaviour=void 0;var r,i=function(){function t(){var t;this.behaviours=((t={normal:function(t,e){return e.tiles.filter(function(e){return e&&e.group===t.group})}})[r.RowDestroyer]=function(t,e){for(var o=[],r=0;r<e.width;r++){var i=e.getTileAt(t.position.y,r);0===(null==i?void 0:i.commitId)&&o.push(i)}return o},t[r.ColumnDestroyer]=function(t,e){for(var o=[],r=0;r<e.height;r++){var i=e.getTileAt(r,t.position.x);0===(null==i?void 0:i.commitId)&&o.push(i)}return o},t[r.RegionDestroyer]=function(t,e){for(var o=[],r=Math.max(0,t.position.x-1),i=Math.max(0,t.position.y-1),n=Math.min(e.width-1,t.position.x+1),s=Math.min(e.height-1,t.position.y+1),c=r;c<=n;c++)for(var l=i;l<=s;l++){var a=e.getTileAt(l,c);0===(null==a?void 0:a.commitId)&&o.push(a)}return o},t[r.FieldDestroyer]=function(t,e){return e.tiles.filter(function(t){return 0===(null==t?void 0:t.commitId)})},t)}return t.prototype.run=function(t,e){var o=this.behaviours[t.behaviour||"normal"];return o?o(t,e):[]},t.prototype.getBehaviour=function(t){return t.length>=9?r.FieldDestroyer:t.length>=7?r.RegionDestroyer:t.length>=5?Math.random()>.5?r.ColumnDestroyer:r.RowDestroyer:null},t}();o.default=i,function(t){t.RowDestroyer="rowDestroyer",t.ColumnDestroyer="columnDestroyer",t.RegionDestroyer="regionDestroyer",t.FieldDestroyer="fieldDestroyer"}(r=o.TileBehaviour||(o.TileBehaviour={})),cc._RF.pop()},{}],TileControllerFactory:[function(t,e,o){"use strict";cc._RF.push(e,"08f5965SJxMCazUIKJketxE","TileControllerFactory"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("../Tile/TileController"),i=function(){function t(t,e,o,i,n){var s=this;void 0===n&&(n=0),this.pool=[],this.prefab=t,this.parent=e,this.tileSize=o,this.tileTypes=i,this.pool=new Array(n).fill(null).map(function(){var t=cc.instantiate(s.prefab);return t.parent=s.parent,t.active=!1,t.getComponent(r.default)})}return t.prototype.getInstance=function(t){var e;if(this.pool.length>0)e=this.pool.pop();else{var o=cc.instantiate(this.prefab);o.parent=this.parent,e=o.getComponent(r.default)}return e.setSize({x:this.tileSize,y:this.tileSize}),e.setPosition(t.position,!0),e.setup(t,this.getSpriteFrame(t.type,t.behaviour)),e.node.active=!0,e},t.prototype.releaseInstance=function(t){this.pool.push(t),t.node.active=!1},t.prototype.clearPool=function(){for(var t=0,e=this.pool;t<e.length;t++)e[t].destroy();this.pool=[]},t.prototype.getSpriteFrame=function(t,e){var o="special"===t?e:t,r=this.tileTypes.find(function(t){return t.type===o});return r?r.sprite:null},t}();o.default=i,cc._RF.pop()},{"../Tile/TileController":"TileController"}],TileController:[function(t,e,o){"use strict";cc._RF.push(e,"21d4fuWRWdBRp/7EpebkEZo","TileController");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(i,n){function s(t){try{l(r.next(t))}catch(e){n(e)}}function c(t){try{l(r.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,r,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],r=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var l=t("./TileView"),a=cc._decorator,u=a.ccclass,p=a.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tileView=null,e.behaviour=null,e.positionOffset={x:0,y:0},e}return i(e,t),e.prototype.setup=function(t,e){this.tileId=t.id,this.behaviour=t.behaviour,this.tileView.setup(e)},e.prototype.setSize=function(t){this.node.setContentSize(t.x,t.y),this.positionOffset={x:t.x/2,y:t.y/2}},e.prototype.setPosition=function(t,e){void 0===e&&(e=!1);var o={x:t.x*this.node.width+this.positionOffset.x,y:-t.y*this.node.height-this.positionOffset.y};e?this.node.setPosition(o.x,o.y):this.tileView.moveTo(o)},e.prototype.rejectAction=function(){this.tileView.shake()},e.prototype.destroyTile=function(){return s(this,void 0,Promise,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.tileView.remove()];case 1:return t.sent(),[2]}})})},n([p(l.default)],e.prototype,"tileView",void 0),n([u],e)}(cc.Component);o.default=f,cc._RF.pop()},{"./TileView":"TileView"}],TileLifecycleManager:[function(t,e,o){"use strict";cc._RF.push(e,"70ce0jRQDJK/Zy1VLUldNiS","TileLifecycleManager");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(i,n){function s(t){try{l(r.next(t))}catch(e){n(e)}}function c(t){try{l(r.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,r,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],r=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}},l=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<o;e++)for(var n=arguments[e],s=0,c=n.length;s<c;s++,i++)r[i]=n[s];return r};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../Effects/EffectControllerBase"),u=t("../Services/TileBehaviourService"),p=t("../Services/TileControllerFactory"),f=t("../utils/ObjectPool"),h=cc._decorator,d=h.ccclass,y=h.property,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tileContainer=null,e.tilePrefab=null,e.tileRemoveParticles=null,e.bombParticles=null,e.effects={},e}return i(e,t),e.prototype.setup=function(t,e,o,r,i){var n;this.tileControllersFactory=new p.default(this.tilePrefab,this.tileContainer,t,l(e,o),r*i),this.removeParticlePool=new f.default(this.tileRemoveParticles),this.bombParticlePool=new f.default(this.bombParticles),this.effects=((n={})[u.TileBehaviour.RegionDestroyer]=this.bombParticlePool,n)},e.prototype.createTile=function(t,e){var o=this.tileControllersFactory.getInstance(t);return e&&o.setPosition(e,!0),o},e.prototype.removeTile=function(t){return s(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return this.showEffect(t),[4,t.destroyTile()];case 1:return e.sent(),this.tileControllersFactory.releaseInstance(t),[2]}})})},e.prototype.reset=function(){var t,e,o;null===(t=this.tileControllersFactory)||void 0===t||t.clearPool(),null===(e=this.removeParticlePool)||void 0===e||e.clear(),null===(o=this.bombParticlePool)||void 0===o||o.clear()},e.prototype.showEffect=function(t){var e=this.effectResolver(t.behaviour),o=e.create(this.tileContainer);o.setPosition(t.node.position);var r=o.getComponent(a.default);r.playEffect(),r.node.once("finished",function(){e.release(o)})},e.prototype.effectResolver=function(t){return this.effects[t]||this.removeParticlePool},n([y(cc.Node)],e.prototype,"tileContainer",void 0),n([y(cc.Prefab)],e.prototype,"tilePrefab",void 0),n([y(cc.Prefab)],e.prototype,"tileRemoveParticles",void 0),n([y(cc.Prefab)],e.prototype,"bombParticles",void 0),n([d],e)}(cc.Component);o.default=v,cc._RF.pop()},{"../Effects/EffectControllerBase":"EffectControllerBase","../Services/TileBehaviourService":"TileBehaviourService","../Services/TileControllerFactory":"TileControllerFactory","../utils/ObjectPool":"ObjectPool"}],TileModelFactory:[function(t,e,o){"use strict";cc._RF.push(e,"6a266CX5qVNYr6jr5Xo0+RU","TileModelFactory"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("../Tile/TileModel"),i=function(){function t(){this.pool=[]}return t.prototype.create=function(t){var e;return void 0===t&&(t={}),(e=this.pool.length>0?this.pool.pop():new r.default).id=this.generateId(),e.commitId=0,e.position=t.position||e.position,e.type=t.type||e.type,e.behaviour=t.behaviour||null,e},t.prototype.release=function(t){this.pool.push(t)},t.prototype.clearPool=function(){this.pool=[]},t.prototype.generateId=function(){return Math.random().toString(36).substring(2,9)},t}();o.default=i,cc._RF.pop()},{"../Tile/TileModel":"TileModel"}],TileModel:[function(t,e,o){"use strict";cc._RF.push(e,"94a52JLR+NNlJA4IqUVS1mP","TileModel"),Object.defineProperty(o,"__esModule",{value:!0});o.default=function(){this.behaviour=null,this.commitId=0},cc._RF.pop()},{}],TileRemoveAnimation:[function(t,e,o){"use strict";cc._RF.push(e,"f191ff5vy1N7paPlL/cfcpN","TileRemoveAnimation");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./EffectControllerBase"),c=t("../utils/Utils"),l=cc._decorator,a=l.ccclass,u=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.circle=null,e.star=null,e.numStars=5,e.jumpHeight=10,e.durationUp=.2,e.durationDown=.7,e.starScale=1,e.starColor=new cc.Color(255,215,0),e.center=null,e.stars=[],e}return i(e,t),e.prototype.onLoad=function(){this.center=new cc.Node,this.center.addComponent(cc.Sprite).spriteFrame=this.circle,this.node.addChild(this.center),this.stars=[];for(var t=0;t<this.numStars;t++){var e=new cc.Node;e.addComponent(cc.Sprite).spriteFrame=this.star,e.color=this.starColor,this.node.addChild(e),this.stars.push(e)}},e.prototype.playEffect=function(){var t=this;this.center.setScale(1,1,1),cc.tween(this.center).to(.3,{scale:0},{easing:"quadIn"}).start(),this.stars.forEach(function(e){t.animateStar(e)}),c.delay(1e3).then(function(){t.node.emit("finished")})},e.prototype.animateStar=function(t){t.setPosition(0,0,0);var e=cc.math.randomRange(.8*this.starScale,1.2*this.starScale);t.setScale(e,e,1);var o=t.position;t.color=this.starColor,t.opacity=this.starColor.a;var r=cc.math.randomRange(150,30),i=cc.misc.degreesToRadians(r),n=new cc.Vec3(Math.cos(i),Math.sin(i),0).normalize(),s=o.add(n.multiplyScalar(this.jumpHeight)),c=s.clone().add(cc.v3(0,-200,0)),l=cc.math.randomRange(0,200);cc.tween(t).delay(l/1e3).to(this.durationUp,{position:s},{easing:"quadOut"}).parallel(cc.tween(t).to(this.durationDown,{position:c},{easing:"quadIn"}),cc.tween(t).to(this.durationDown,{opacity:0},{easing:"expoIn"})).start()},n([u(cc.SpriteFrame)],e.prototype,"circle",void 0),n([u(cc.SpriteFrame)],e.prototype,"star",void 0),n([u(cc.Integer)],e.prototype,"numStars",void 0),n([u],e.prototype,"jumpHeight",void 0),n([u],e.prototype,"durationUp",void 0),n([u],e.prototype,"durationDown",void 0),n([u],e.prototype,"starScale",void 0),n([u(cc.Color)],e.prototype,"starColor",void 0),n([a],e)}(s.default);o.default=p,cc._RF.pop()},{"../utils/Utils":"Utils","./EffectControllerBase":"EffectControllerBase"}],TileType:[function(t,e,o){"use strict";cc._RF.push(e,"d92988fUeVJsJY0aq8RKpJl","TileType");var r=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,n=i.ccclass,s=i.property,c=function(){function t(){this.type="",this.sprite=null}return r([s()],t.prototype,"type",void 0),r([s(cc.SpriteFrame)],t.prototype,"sprite",void 0),r([n("TileType")],t)}();o.default=c,cc._RF.pop()},{}],TileView:[function(t,e,o){"use strict";cc._RF.push(e,"971073Bx0hOSJYJxfkgPUZL","TileView");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,o,s):i(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(i,n){function s(t){try{l(r.next(t))}catch(e){n(e)}}function c(t){try{l(r.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,r,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],r=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var l=cc._decorator,a=l.ccclass,u=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.groupIdLabel=null,e.sprite=null,e.moveSpeed=1e3,e.direction=cc.v3(0,-1,0),e.targetPosition=null,e.isRemoving=!1,e.currentDistance=cc.v3(0,0,0),e.moveStep=cc.v3(0,0,0),e}return i(e,t),e.prototype.setup=function(t){this.sprite.spriteFrame=t,this.node.scale=1},e.prototype.moveTo=function(t){this.isRemoving||this.node.position.x===t.x&&this.node.position.y===t.y||(this.targetPosition=cc.v3(t.x,t.y,this.node.position.z),cc.Vec3.subtract(this.direction,this.targetPosition,this.node.position),this.direction.normalizeSelf(),this.node.scaleY=1.3)},e.prototype.shake=function(){var t=this.node.position.clone();cc.tween(this.node).by(.05,{position:cc.v2(3,0)}).by(.1,{position:cc.v2(-6,0)}).by(.1,{position:cc.v2(6,0)}).by(.1,{position:cc.v2(-6,0)}).by(.05,{position:cc.v2(3,0)}).to(0,{position:t}).start()},e.prototype.update=function(t){if(this.targetPosition){var e=this.node.position;if(cc.Vec3.subtract(this.currentDistance,this.targetPosition,e),cc.Vec3.multiplyScalar(this.moveStep,this.direction,this.moveSpeed*t),this.moveStep.magSqr()>=this.currentDistance.magSqr())this.node.setPosition(this.targetPosition),this.targetPosition=null,this.node.scaleY=1,this.playImpactAnimations();else{var o=e.clone().add(this.moveStep);this.node.setPosition(o)}}},e.prototype.remove=function(){return s(this,void 0,Promise,function(){var t=this;return c(this,function(){return this.isRemoving=!0,this.targetPosition=null,[2,new Promise(function(e){cc.tween(t.node).to(.2,{scale:0}).call(function(){t.isRemoving=!1,e()}).start()})]})})},e.prototype.playImpactAnimations=function(){var t=this;cc.tween({y:1}).to(.1,{y:.9},{progress:function(e,o,r,i){return t.node.scaleY=r,e+(o-e)*i}}).to(.1,{y:1},{progress:function(e,o,r,i){return t.node.scaleY=r,e+(o-e)*i}}).start();var e=this.node.position.clone();cc.tween(this.node).by(.1,{position:cc.v2(0,5)},{easing:"backOut"}).to(.1,{position:e},{easing:"backOut"}).start()},n([u(cc.Label)],e.prototype,"groupIdLabel",void 0),n([u(cc.Sprite)],e.prototype,"sprite",void 0),n([u(cc.Float)],e.prototype,"moveSpeed",void 0),n([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],TypedTile:[function(t,e,o){"use strict";cc._RF.push(e,"bb8aesLEnVFZILdonWnWGTv","TypedTile"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],Utils:[function(t,e,o){"use strict";cc._RF.push(e,"e99b5TMCFpNjrlHJPPcu32t","Utils"),Object.defineProperty(o,"__esModule",{value:!0}),o.getDistance=o.delay=void 0,o.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},o.getDistance=function(t,e){return Math.max(Math.abs(t.x-e.x),Math.abs(t.y-e.y))},cc._RF.pop()},{}]},{},["BoardController","BoardModel","TileLifecycleManager","DialogController","DialogView","EffectControllerBase","ParticleController","TileRemoveAnimation","GameController","ProgressControllerBase","ScoreProgressController","TileBehaviourService","TileControllerFactory","TileModelFactory","TileController","TileModel","TileView","TypedTile","TileType","EffectProcessor","ObjectPool","Point","Utils"]);